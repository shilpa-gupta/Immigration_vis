<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset=utf-8>
    <title>Immigration Visualization</title>
    <link rel="stylesheet" type="text/css" href="../css/style.css" />

</head>
<body>
  <div id="main">
    <div id="header">
      <div id="logo">
        <div id="logo_text">
          <h1><a href="index.html">Immigration<span class="logo_colour">Visualization</span></a></h1>
            <h2>visualize how people move across the world</h2>
        </div>
      </div>
      <div id="menubar">
        <ul id="menu">
          <li class="selected"><a href="index.html">Home</a></li>
          <li><a href="bar_chart.html">Bar Chart</a></li>
          <li><a href="radial_plot.html">Radial Plot</a></li>
          <li><a href="map_vis.html">Map</a></li>
        </ul>
      </div>
    </div>
    <div id="content_header">
      <center>
            <h1>World Population: <strong>6,853,328,460</strong></h1>
          <h3>Migrants in the world: <strong>215,738,321</strong></h3>
      </center>
    </div>

    <div id="site_content">
      <center>
        <h3>World population continues to increase. With current world population now over 7 billion people,there is significant pressure for excess population to migrate from more densely populated countries to those less populated. 
        </h3>
      </center>
      <center>
        <h3>
        Almost 216 million people, or 3.15% of the world population, live outside their countries. </h3>
      </center>
    </div>
    <div id="content">
      <h2><center>Who is migrating from where to where?</center></h2>
        <div id="plots">
        <table>
            <tr>
                <th>
                    <div id="pie1"></div>
                </th>
                <th>
                    <div id="pie2"></div>
                </th>
            </tr>

        </table>

        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script>


            (function(d3) {
                'use strict';
                var width = 800;
                var height = 600;
                var radius = Math.min(400,400) / 2;

                var legendRectSize = 18;
                var legendSpacing = 4;
                var color = d3.scaleOrdinal(d3.schemeCategory20b);
                var svg = d3.select('#pie1')
                    .append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g')
                    .attr('transform', 'translate(' + (width / 2) +
                        ',' + (height / 2) + ')');
                var arc = d3.arc()
                    .innerRadius(0)
                    .outerRadius(radius);
                var pie = d3.pie()
                    .value(function(d) { return d.count; })
                    .sort(null);
                var tooltip = d3.select('#pie1')                               
                    .append('div')                                                
                    .attr('class', 'tooltip');                                   
                tooltip.append('div')                                           
                    .attr('class', 'label');                                      
                tooltip.append('div')                                           
                    .attr('class', 'count');                                     
                tooltip.append('div')                                          
                    .attr('class', 'percent');                                    
                d3.csv('../../data/top_sorted_barchart.csv', function(error, dataset) {
                    dataset.forEach(function(d) {
                        d.count = +d.count;
                    });
                    var path = svg.selectAll('path')
                        .data(pie(dataset))
                        .enter()
                        .append('path')
                        .attr('d', arc)
                        .attr('fill', function(d, i) {
                            return color(d.data.label);
                        });
                    path.on('mouseover', function(d) {                            
                        var total = d3.sum(dataset.map(function(d) {                
                            return d.count;                                           
                        }));                                                        
                        var percent = Math.round(1000 * d.data.count / total) / 10; 
                        tooltip.select('.label').html(d.data.label);                
                        tooltip.select('.count').html(d.data.count);                
                        tooltip.select('.percent').html(percent + '%');             
                        tooltip.style('display', 'block');

                        tooltip.attr('transform', function(d, i) {
                            var height = legendRectSize + legendSpacing;
                            var offset =  height * color.domain().length / 2;
                            var horz = 14* legendRectSize;
                            var vert = i * height - offset;
                            return 'translate(' + horz + ',' + vert + ')';
                        });
                    });                                                           
                    path.on('mouseout', function() {                              
                        tooltip.style('display', 'none');                           
                    });                                                           
                    /* OPTIONAL
                     path.on('mousemove', function(d) {                            
                     tooltip.style('top', (d3.event.layerY + 10) + 'px')         
                     .style('left', (d3.event.layerX + 10) + 'px');            
                     });                                                           
                     */
                    var legend = svg.selectAll('.legend')
                        .data(color.domain())
                        .enter()
                        .append('g')
                        .attr('class', 'legend')
                        .attr('transform', function(d, i) {
                            var height = legendRectSize + legendSpacing;
                            var offset =  height * color.domain().length / 2;
                            var horz = 14* legendRectSize;
                            var vert = i * height - offset;
                            return 'translate(' + horz + ',' + vert + ')';
                        });
                    legend.append('rect')
                        .attr('width', legendRectSize)
                        .attr('height', legendRectSize)
                        .style('fill', color)
                        .style('stroke', color);
                    legend.append('text')
                        .attr('x', legendRectSize + legendSpacing)
                        .attr('y', legendRectSize - legendSpacing)
                        .text(function(d) { return d; });
                });
            })(window.d3);
        </script>



      <script src="https://d3js.org/d3.v4.min.js"></script>
      <script>



          (function(d3) {
              'use strict';
              var width = 800;
              var height = 600;
              var radius = Math.min(400, 400) / 2;
              var donutWidth = 75;
              var legendRectSize = 18;
              var legendSpacing = 4;
              var color = d3.scaleOrdinal(d3.schemeCategory20b);
              var svg = d3.select('#pie2')
                  .append('svg')
                  .attr('width', width)
                  .attr('height', height)
                  .append('g')
                  .attr('transform', 'translate(' + (width / 2) +
                      ',' + (height / 2) + ')');
              var arc = d3.arc()
                  .innerRadius(0)
                  .outerRadius(radius);
              var pie = d3.pie()
                  .value(function(d) { return d.count; })
                  .sort(null);
              var tooltip = d3.select('#pie2')                               
                  .append('div')                                                
                  .attr('class', 'tooltip');                                    
              tooltip.append('div')                                           
                  .attr('class', 'label');                                      
              tooltip.append('div')                                           
                  .attr('class', 'count');                                      
              tooltip.append('div')                                           
                  .attr('class', 'percent');                                    
              d3.csv('../../data/top_sorted_coming.csv', function(error, dataset) {
                  dataset.forEach(function(d) {
                      d.count = +d.count;
                  });
                  var path = svg.selectAll('path')
                      .data(pie(dataset))
                      .enter()
                      .append('path')
                      .attr('d', arc)
                      .attr('fill', function(d, i) {
                          return color(d.data.label);
                      });
                  path.on('mouseover', function(d) {                            
                      var total = d3.sum(dataset.map(function(d) {                
                          return d.count;                                           
                      }));                                                        
                      var percent = Math.round(1000 * d.data.count / total) / 10; 
                      tooltip.select('.label').html(d.data.label);                
                      tooltip.select('.count').html(d.data.count);                
                      tooltip.select('.percent').html(percent + '%');             
                      tooltip.style('display', 'block');                          
                  });                                                           
                  path.on('mouseout', function() {                              
                      tooltip.style('display', 'none');                           
                  });                                                           
                  /* OPTIONAL
                   path.on('mousemove', function(d) {                            
                   tooltip.style('top', (d3.event.layerY + 10) + 'px')         
                   .style('left', (d3.event.layerX + 10) + 'px');            
                   });                                                           
                   */
                  var legend = svg.selectAll('.legend')
                      .data(color.domain())
                      .enter()
                      .append('g')
                      .attr('class', 'legend')
                      .attr('transform', function(d, i) {
                          var height = legendRectSize + legendSpacing;
                          var offset =  height * color.domain().length / 2;
                          var horz = 14* legendRectSize;
                          var vert = i * height - offset;
                          return 'translate(' + horz + ',' + vert + ')';
                      });
                  legend.append('rect')
                      .attr('width', legendRectSize)
                      .attr('height', legendRectSize)
                      .style('fill', color)
                      .style('stroke', color);
                  legend.append('text')
                      .attr('x', legendRectSize + legendSpacing)
                      .attr('y', legendRectSize - legendSpacing)
                      .text(function(d) { return d; });
              });
          })(window.d3);
      </script>
        </div>

  </div>
  </div>
</body>
</html>
